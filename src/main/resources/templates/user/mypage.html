<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
 
</head>
<body>
<div th:replace="~{layout/header :: header}">Header</div>
    <h1>마이페이지</h1>
    <p id="useruid">사용자 UID: </p>
    <p id="useremail">이메일: </p>
 
	
	
	<script>
	document.addEventListener("DOMContentLoaded", function () {
	    const token = localStorage.getItem("token");

	    if (!token) {
	        alert("로그인이 필요합니다.");
	        window.location.href = "/user/login"; // 로그인 페이지로 리다이렉트
	        return;
	    }

	    fetch("/api/mypage", {
	        method: "GET",
	        headers: {
	            "Authorization": "Bearer " + token // Bearer 형식으로 토큰을 추가
	        }
	    })
	    .then(response => {
	        if (!response.ok) {
	            return response.text().then(text => {
	                console.error("Error response:", text); // 응답 내용 확인
	                throw new Error('응답이 정상적이지 않습니다.');
	            });
	        }
	        return response.json(); // JSON 응답 파싱
	    })
	    .then(data => {
	        if (data.error) {
	            console.error('Error:', data.error);
	            alert('로그인 정보가 유효하지 않습니다. 다시 로그인해주세요.');
	            window.location.href = "/user/login"; // 로그인 페이지로 이동
	        } else {
	            // 사용자 정보 표시
	            document.getElementById("useruid").innerText = `사용자 ID: ${data.uid}`;
	            document.getElementById("useremail").innerText = `이메일: ${data.email}`;
	        }
	    })
	    .catch(error => {
	        console.error('Error:', error);
	        alert("문제가 발생했습니다. 다시 로그인해주세요.");
	        window.location.href = "/user/login"; // 로그인 페이지로 이동
	    });
	});

	</script>
	 <script src="/js/common.js"></script>
</body>
</html>
